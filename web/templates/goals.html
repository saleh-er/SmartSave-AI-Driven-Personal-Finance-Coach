<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartSave - Goals</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <header class="brand-header">
            <h1>Your Goals</h1>
            <p>Save money for what matters</p>
        </header>

        <main class="goals-container" style="display: flex; flex-direction: column; gap: 20px; padding-bottom: 150px;">
            
            {% for goal in goals %}
            <div class="glass-card goal-card" style="position: relative; overflow: hidden;">
                <div style="position: absolute; left: 0; top: 0; bottom: 0; width: 6px; background: {{ goal.color }};"></div>
                
                <div style="padding-left: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <div>
                            <h3 style="margin: 0; font-size: 1.2rem;">{{ goal.name }}</h3>
                            <span style="font-size: 0.8rem; color: var(--text-secondary);">Target: €{{ goal.target }}</span>
                        </div>
                        <div style="text-align: right;">
                            {% set percent = (goal.current / goal.target * 100)|int %}
                            <span style="font-size: 1.3rem; font-weight: 800; color: {{ goal.color }};">{{ percent }}%</span>
                        </div>
                    </div>

                    <div class="progress-track" style="background: rgba(255,255,255,0.1); height: 12px; border-radius: 6px; margin-bottom: 10px;">
                        <div class="progress-fill" 
                             style="width: {{ percent }}%; 
                                    height: 100%; 
                                    background: {{ goal.color }}; 
                                    border-radius: 6px;
                                    box-shadow: 0 0 15px {{ goal.color }}66;">
                        </div>
                    </div>

                    <div style="display: flex; justify-content: space-between; font-size: 0.9rem;">
                        <span style="font-weight: 600;">€{{ goal.current }} saved</span>
                        <span style="color: var(--text-secondary);">€{{ goal.target - goal.current }} left</span>
                    </div>
                </div>
            </div>
            {% endfor %}

            <div id="goal-form" class="glass-card" style="display: none; border: 1px solid var(--accent-teal);">
                <h3 style="margin-bottom: 15px; font-size: 1.1rem;">New Saving Goal</h3>
                <input type="text" id="goal-name" placeholder="What are you saving for?" 
                       style="width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white; outline: none;">
                
                <input type="number" id="goal-target" placeholder="Target Amount (€)" 
                       style="width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 12px; border: 1px solid var(--glass-border); background: rgba(255,255,255,0.05); color: white; outline: none;">
                
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                    <label style="font-size: 0.85rem; color: var(--text-secondary);">Pick a color:</label>
                    <input type="color" id="goal-color" value="#10B981" style="border: none; background: none; width: 40px; height: 40px; cursor: pointer;">
                </div>

                <div style="display: flex; gap: 10px;">
                    <button onclick="saveGoal()" class="action-btn primary" style="flex: 2;">Create Goal</button>
                    <button onclick="hideForm()" class="action-btn secondary" style="flex: 1;">Cancel</button>
                </div>
            </div>

            <button id="add-btn" onclick="showForm()" class="glass-card" style="border: 2px dashed var(--glass-border); background: transparent; color: var(--text-secondary); padding: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%;">
                <i class="fas fa-plus"></i> Add New Goal
            </button>
        </main>

        <nav class="bottom-nav">
            <a href="/" class="nav-link {{ 'active' if request.url.path == '/' }}">
                <i class="fas fa-home"></i> <span>Home</span>
            </a>
            <a href="/analytics" class="nav-link {{ 'active' if request.url.path == '/analytics' }}">
                <i class="fas fa-chart-line"></i> <span>Stats</span>
            </a>
            <a href="/coach" class="nav-link {{ 'active' if request.url.path == '/coach' }}">
                <i class="fas fa-wand-magic-sparkles"></i> <span>Coach</span>
            </a>
            <a href="/goals" class="nav-link {{ 'active' if request.url.path == '/goals' }}">
                <i class="fas fa-bullseye"></i> <span>Goals</span>
            </a>
        </nav>
    </div>

    <script>
        function showForm() {
            document.getElementById('goal-form').style.display = 'block';
            document.getElementById('add-btn').style.display = 'none';
            document.getElementById('goal-name').focus();
        }

        function hideForm() {
            document.getElementById('goal-form').style.display = 'none';
            document.getElementById('add-btn').style.display = 'flex';
        }

        async function saveGoal() {
            const name = document.getElementById('goal-name').value;
            const target = document.getElementById('goal-target').value;
            const color = document.getElementById('goal-color').value;

            if (!name || !target) {
                alert("Please name your goal and set a target!");
                return;
            }

            const response = await fetch('/add-goal', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, target, color })
            });

            if (response.ok) {
                // Petit effet de succès avant de recharger
                document.getElementById('goal-form').style.borderColor = "#10B981";
                setTimeout(() => window.location.reload(), 500);
            }
        }
    </script>
</body>
</html>